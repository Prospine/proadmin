ALTER TABLE `tests`
ADD COLUMN `test_uid` VARCHAR(20) NULL DEFAULT NULL AFTER `test_id`,
ADD UNIQUE INDEX `test_uid_unique` (`test_uid`);

------------ Done -------------

ALTER TABLE `quick_inquiry`
ADD COLUMN `inquiry_type` VARCHAR(50) NULL DEFAULT NULL COMMENT 'e.g., physio, speech_therapy' AFTER `gender`,
ADD COLUMN `communication_type` VARCHAR(50) NULL DEFAULT NULL COMMENT 'e.g., phone, web, email' AFTER `inquiry_type`;

ALTER TABLE `expenses`
ADD COLUMN `expense_done_by` VARCHAR(100) NULL DEFAULT NULL COMMENT 'Name of person who did the expense' AFTER `paid_to`,
ADD COLUMN `expense_for` VARCHAR(100) NULL DEFAULT NULL COMMENT 'Purpose of the expense, e.g., Office, Marketing' AFTER `expense_done_by`;

ALTER TABLE `patients`
ADD COLUMN `service_type` VARCHAR(50) NOT NULL DEFAULT 'physio' COMMENT 'e.g., physio, speech_therapy' AFTER `assigned_doctor`;

CREATE TABLE `patient_appointments` (
  `appointment_id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `patient_id` INT(11) NOT NULL,
  `branch_id` INT(11) NOT NULL,
  `appointment_date` DATE NOT NULL,
  `time_slot` TIME NOT NULL,
  `service_type` VARCHAR(50) NOT NULL COMMENT 'e.g., physio, speech_therapy',
  `status` VARCHAR(50) NOT NULL DEFAULT 'scheduled' COMMENT 'e.g., scheduled, completed, cancelled',
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`appointment_id`),
  INDEX `idx_patient_id` (`patient_id`),
  INDEX `idx_branch_id_date_service` (`branch_id`, `appointment_date`, `service_type`),
  CONSTRAINT `fk_patient_appointments_patient` FOREIGN KEY (`patient_id`) REFERENCES `patients` (`patient_id`) ON DELETE CASCADE,
  CONSTRAINT `fk_patient_appointments_branch` FOREIGN KEY (`branch_id`) REFERENCES `branches` (`branch_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

ALTER TABLE `patients` 
ADD COLUMN `treatment_time_slot` TIME NULL DEFAULT NULL COMMENT 'Initial time slot chosen at registration' AFTER `payment_method`;


------------------done-----------------

CREATE TABLE `test_items` (
  `item_id` INT(11) NOT NULL AUTO_INCREMENT,
  `test_id` INT(11) NOT NULL COMMENT 'Foreign key to the main tests table (the order header)',
  `assigned_test_date` DATE NOT NULL,
  `test_name` ENUM('eeg','ncv','emg','rns','bera','vep','other') NOT NULL,
  `limb` ENUM('upper_limb','lower_limb','both','none') DEFAULT NULL,
  `referred_by` VARCHAR(100) DEFAULT NULL,
  `test_done_by` VARCHAR(100) NOT NULL,
  `total_amount` DECIMAL(10,2) NOT NULL,
  `advance_amount` DECIMAL(10,2) DEFAULT 0.00,
  `due_amount` DECIMAL(10,2) DEFAULT 0.00,
  `discount` DECIMAL(10,2) DEFAULT NULL,
  `payment_method` ENUM('cash','upi','upi-boi','upi-hdfc','card','cheque','other') DEFAULT 'cash',
  `test_status` ENUM('pending','completed','cancelled') NOT NULL DEFAULT 'pending',
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`item_id`),
  KEY `fk_test_items_test_id` (`test_id`),
  CONSTRAINT `test_items_ibfk_1` FOREIGN KEY (`test_id`) REFERENCES `tests` (`test_id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

ALTER TABLE `test_items`
ADD COLUMN `payment_status` ENUM('pending', 'partial', 'paid') NOT NULL DEFAULT 'pending' AFTER `test_status`;

----------done---------------------

-- Add refund_status to the main tests table
ALTER TABLE `tests`
ADD COLUMN `refund_status` ENUM('no', 'initiated', 'completed') NOT NULL DEFAULT 'no' AFTER `payment_status`;

-- Add refund_status to the test_items table
ALTER TABLE `test_items`
ADD COLUMN `refund_status` ENUM('no', 'initiated', 'completed') NOT NULL DEFAULT 'no' AFTER `payment_status`;

ALTER TABLE `registration`
ADD COLUMN `refund_status` ENUM('no', 'initiated', 'completed') NOT NULL DEFAULT 'no' AFTER `status`;

___________done________________________

CREATE TABLE `employees` (
  `employee_id` INT(11) NOT NULL AUTO_INCREMENT,
  `user_id` INT(11) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `job_title` VARCHAR(100) DEFAULT NULL COMMENT 'e.g., Receptionist, Senior Physiotherapist',
  `phone_number` VARCHAR(20) DEFAULT NULL,
  `address` TEXT DEFAULT NULL,
  `date_of_birth` DATE DEFAULT NULL,
  `date_of_joining` DATE NOT NULL,
  `is_active` TINYINT(1) NOT NULL DEFAULT 1 COMMENT '1 = Active, 0 = Inactive',
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`employee_id`),
  UNIQUE KEY `user_id_unique` (`user_id`),
  CONSTRAINT `fk_employees_users`
    FOREIGN KEY (`user_id`) 
    REFERENCES `users`(`id`) 
    ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
